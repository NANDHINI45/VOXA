<%- include('partials/header') %>

  <div class="container" style="padding-top: 3rem; max-width: 700px;">

    <div class="card">
      <h1 style="text-align: center; margin-bottom: 2rem; color: var(--text-main);">
        <%= listTitle %>
      </h1>

      <form action="/add" method="post" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
        <input type="text" name="newItem" class="form-control" placeholder="Add a new task..." autocomplete="off"
          autofocus required style="margin-bottom: 0;">
        <button class="btn btn-primary" type="submit" name="list" value="<%= listTitle %>"
          style="width: 60px; font-size: 1.25rem;"><i class="fas fa-plus"></i></button>
      </form>

      <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        <% for(let item of listItems) { %>
          <div
            style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: var(--radius-sm); border: 1px solid #e9ecef; transition: transform 0.2s;">

            <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
              <form action="/delete" method="post" style="margin: 0; display: flex; align-items: center;">
                <input type="checkbox" onchange="this.form.submit()" name="deleteItemId" value="<%= item.note_id %>"
                  style="width: 22px; height: 22px; accent-color: var(--primary); cursor: pointer;">
              </form>

              <p id="title<%= item.note_id %>"
                style="margin: 0; font-size: 1.1rem; color: var(--text-main); font-weight: 500;">
                <%= item.title %>
              </p>

              <form class="edit" action="/edit" method="post" style="flex: 1; display: none;"
                id="form<%= item.note_id %>">
                <input type="hidden" name="updatedItemId" value="<%= item.note_id %>">
                <input id="input<%= item.note_id %>" type="text" name="updatedItemTitle" value="<%= item.title %>"
                  class="form-control" autocomplete="off" style="padding: 0.5rem; margin-bottom: 0;">
                <button type="submit" hidden></button>
              </form>
            </div>

            <div style="display: flex; gap: 0.5rem;">
              <button id="edit<%= item.note_id %>" onclick="toggleEdit('<%= item.note_id %>')" class="btn btn-secondary"
                style="padding: 0.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;"><i
                  class="fas fa-pencil-alt" style="font-size: 0.9rem;"></i></button>
              <button id="done<%= item.note_id %>" type="submit" form="form<%= item.note_id %>" class="btn btn-success"
                style="padding: 0.5rem; background: var(--success); color: white; border: none; width: 40px; height: 40px; display: none; align-items: center; justify-content: center;"><i
                  class="fas fa-check"></i></button>
            </div>

          </div>
          <% } %>

            <% if(listItems.length===0) { %>
              <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                <p>No tasks yet. Add one above!</p>
              </div>
              <% } %>
      </div>
    </div>
  </div>

  <script>
    function toggleEdit(id) {
      document.getElementById("title" + id).style.display = "none";
      document.getElementById("form" + id).style.display = "block";
      document.getElementById("edit" + id).style.display = "none";
      document.getElementById("done" + id).style.display = "flex"; // Changed to flex to center icon
      document.getElementById("input" + id).focus();
    }
  </script>

  <%- include('partials/footer') %>